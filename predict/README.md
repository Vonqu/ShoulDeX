# è§’åº¦é¢„æµ‹ä»ªè¡¨æ¿ç³»ç»Ÿ

è¿™æ˜¯ä¸€ä¸ªåŸºäºLSTMæ¨¡å‹çš„å®æ—¶è§’åº¦é¢„æµ‹ç³»ç»Ÿï¼ŒåŒ…å«å‰ç«¯å¯è§†åŒ–ç•Œé¢å’Œåç«¯é¢„æµ‹æœåŠ¡ã€‚

## ç³»ç»Ÿæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    WebSocket    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   å‰ç«¯ç•Œé¢      â”‚ â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ â”‚   WebSocket     â”‚
â”‚ (HTML/CSS/JS)   â”‚                 â”‚    æœåŠ¡å™¨       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                              â”‚
                                              â–¼
                                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                    â”‚   LSTMæ¨¡å‹      â”‚
                                    â”‚   é¢„æµ‹æœåŠ¡      â”‚
                                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                              â”‚
                                              â–¼
                                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                    â”‚   ä¸²å£æ•°æ®      â”‚
                                    â”‚   (ä¼ æ„Ÿå™¨)      â”‚
                                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## æ–‡ä»¶è¯´æ˜

- `angle_prediction_dashboard.html` - å‰ç«¯ç•Œé¢ï¼Œ3x3ç½‘æ ¼å¸ƒå±€æ˜¾ç¤º27ä¸ªè§’åº¦
- `websocket_server.py` - WebSocketæœåŠ¡å™¨ï¼Œå¤„ç†å®æ—¶æ•°æ®é¢„æµ‹
- `start_dashboard.py` - å¯åŠ¨è„šæœ¬ï¼Œä¸€é”®å¯åŠ¨æ•´ä¸ªç³»ç»Ÿ
- `predict_ds_14Sto27A.py` - åŸå§‹é¢„æµ‹ä»£ç ï¼ˆå‚è€ƒï¼‰

## åŠŸèƒ½ç‰¹ç‚¹

### å‰ç«¯ç•Œé¢
- ğŸ¨ ç°ä»£åŒ–çš„3x3ç½‘æ ¼å¸ƒå±€
- ğŸ“Š å®æ—¶è§’åº¦æ•°æ®å¯è§†åŒ–
- ğŸ¯ 27ä¸ªè§’åº¦çš„å®æ—¶æ˜¾ç¤º
- ğŸ“ˆ å†å²æ•°æ®æ›²çº¿å›¾
- ğŸ“± å“åº”å¼è®¾è®¡ï¼Œæ”¯æŒç§»åŠ¨è®¾å¤‡
- âš¡ å®æ—¶è¿æ¥çŠ¶æ€æ˜¾ç¤º
- ğŸ“Š æ€§èƒ½ç»Ÿè®¡ä¿¡æ¯

### åç«¯æœåŠ¡
- ğŸ”Œ WebSocketå®æ—¶é€šä¿¡
- ğŸ¤– LSTMæ¨¡å‹é¢„æµ‹
- ğŸ“¡ ä¸²å£æ•°æ®è¯»å–
- ğŸ”„ è‡ªåŠ¨é‡è¿æœºåˆ¶
- ğŸ“ è¯¦ç»†æ—¥å¿—è®°å½•

## è§’åº¦åˆ†ç±»

ç³»ç»Ÿæ˜¾ç¤ºä»¥ä¸‹9ç»„è§’åº¦æ•°æ®ï¼š

1. **å·¦è‚±éª¨ä¸èƒ¸å»“** (Left Humerus-Thorax) - è§’åº¦ 0-2
2. **å³è‚±éª¨ä¸èƒ¸å»“** (Right Humerus-Thorax) - è§’åº¦ 3-5
3. **å·¦è‚©èƒ›éª¨ä¸èƒ¸å»“** (Left Scapula-Thorax) - è§’åº¦ 6-8
4. **å³è‚©èƒ›éª¨ä¸èƒ¸å»“** (Right Scapula-Thorax) - è§’åº¦ 9-11
5. **å·¦é”éª¨ä¸èƒ¸å»“** (Left Clavicle-Thorax) - è§’åº¦ 12-14
6. **å³é”éª¨ä¸èƒ¸å»“** (Right Clavicle-Thorax) - è§’åº¦ 15-17
7. **å·¦è‚±éª¨ä¸è‚©èƒ›éª¨** (Left Humerus-Scapula) - è§’åº¦ 18-20
8. **å³è‚±éª¨ä¸è‚©èƒ›éª¨** (Right Humerus-Scapula) - è§’åº¦ 21-23
9. **èƒ¸å»“ä¸é«‹å…³èŠ‚** (Thorax-Hip) - è§’åº¦ 24-26

æ¯ç»„åŒ…å«Xã€Yã€Zä¸‰ä¸ªè½´å‘çš„è§’åº¦æ•°æ®ã€‚

## å¿«é€Ÿå¯åŠ¨

### ä¸€é”®å¯åŠ¨ï¼ˆæ¨èï¼‰

```bash
cd predict
python start_dashboard.py
```

ç³»ç»Ÿå°†è‡ªåŠ¨ï¼š
1. å¯åŠ¨WebSocketæœåŠ¡å™¨ (ç«¯å£8766)
2. è¿æ¥ä¸²å£è®¾å¤‡ (COM7)
3. åŠ è½½LSTMæ¨¡å‹
4. åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€å‰ç«¯ç•Œé¢
5. å¼€å§‹å®æ—¶è§’åº¦é¢„æµ‹

### æ‰‹åŠ¨å¯åŠ¨

1. **å®‰è£…ä¾èµ–**
```bash
pip install websockets pyserial torch numpy pandas matplotlib scikit-learn
```

2. **å¯åŠ¨WebSocketæœåŠ¡å™¨**
```bash
python websocket_server.py
```

3. **æ‰“å¼€å‰ç«¯ç•Œé¢**
```bash
# åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€
file:///path/to/predict/angle_prediction_dashboard.html
```

## é…ç½®è¯´æ˜

### ä¸²å£é…ç½®
åœ¨ `websocket_server.py` ä¸­ä¿®æ”¹ä¸²å£è®¾ç½®ï¼š
```python
self.SERIAL_PORT = "COM7"  # ä¿®æ”¹ä¸ºæ‚¨çš„ä¸²å£
self.BAUD_RATE = 115200    # ä¿®æ”¹æ³¢ç‰¹ç‡
```

### æ¨¡å‹é…ç½®
ç¡®ä¿ä»¥ä¸‹æ–‡ä»¶å­˜åœ¨ï¼š
- `./model/test_0806_1_lstm.pth` - LSTMæ¨¡å‹æ–‡ä»¶
- `./predict/scaler/sensor_scaler_test_0806_1.pkl` - ä¼ æ„Ÿå™¨æ•°æ®æ ‡å‡†åŒ–å™¨
- `./predict/scaler/angle_scaler_test_0806_1.pkl` - è§’åº¦æ•°æ®æ ‡å‡†åŒ–å™¨

### ç½‘ç»œé…ç½®
- WebSocketæœåŠ¡å™¨é»˜è®¤è¿è¡Œåœ¨ `ws://localhost:8765`
- å¦‚éœ€å¤–éƒ¨è®¿é—®ï¼Œä¿®æ”¹ `websocket_server.py` ä¸­çš„hostå‚æ•°

## ä½¿ç”¨è¯´æ˜

1. **å¯åŠ¨ç³»ç»Ÿ**
   - è¿è¡Œå¯åŠ¨è„šæœ¬æˆ–æ‰‹åŠ¨å¯åŠ¨æœåŠ¡å™¨
   - ç¡®ä¿ä¸²å£è®¾å¤‡å·²è¿æ¥

2. **å¼€å§‹é¢„æµ‹**
   - ç‚¹å‡»å‰ç«¯ç•Œé¢çš„"å¼€å§‹é¢„æµ‹"æŒ‰é’®
   - ç³»ç»Ÿå¼€å§‹è¯»å–ä¸²å£æ•°æ®å¹¶å®æ—¶é¢„æµ‹è§’åº¦

3. **æŸ¥çœ‹æ•°æ®**
   - æ¯ä¸ªå°çª—æ ¼æ˜¾ç¤ºå¯¹åº”è§’åº¦ç»„çš„å®æ—¶æ•°æ®
   - æ›²çº¿å›¾æ˜¾ç¤ºå†å²å˜åŒ–è¶‹åŠ¿
   - åº•éƒ¨æ˜¾ç¤ºå½“å‰è§’åº¦æ•°å€¼

4. **åœæ­¢é¢„æµ‹**
   - ç‚¹å‡»"åœæ­¢é¢„æµ‹"æŒ‰é’®åœæ­¢æ•°æ®é‡‡é›†
   - æˆ–å…³é—­æµè§ˆå™¨çª—å£

## æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **Unicodeç¼–ç é”™è¯¯**
   - é—®é¢˜ï¼š`UnicodeEncodeError: 'gbk' codec can't encode character`
   - è§£å†³ï¼šå·²ä¿®å¤ï¼Œä½¿ç”¨ `[SUCCESS]`ã€`[ERROR]` ç­‰æ–‡æœ¬æ ‡ç­¾æ›¿ä»£Unicodeè¡¨æƒ…ç¬¦å·
   - å¦‚æœä»æœ‰é—®é¢˜ï¼Œè¯·ç¡®ä¿Pythonç¯å¢ƒæ”¯æŒUTF-8ç¼–ç 

2. **ä¸²å£è¿æ¥å¤±è´¥**
   - æ£€æŸ¥ä¸²å£è®¾å¤‡æ˜¯å¦æ­£ç¡®è¿æ¥
   - ç¡®è®¤ä¸²å£å·å’Œæ³¢ç‰¹ç‡è®¾ç½®
   - æ£€æŸ¥è®¾å¤‡é©±åŠ¨æ˜¯å¦å®‰è£…
   - è¿è¡Œ `python test_system.py` æ£€æŸ¥ä¸²å£çŠ¶æ€

3. **WebSocketè¿æ¥å¤±è´¥**
   - ç¡®è®¤æœåŠ¡å™¨æ˜¯å¦æ­£å¸¸å¯åŠ¨
   - æ£€æŸ¥é˜²ç«å¢™è®¾ç½®
   - æŸ¥çœ‹æµè§ˆå™¨æ§åˆ¶å°é”™è¯¯ä¿¡æ¯
   - è¿è¡Œ `python test_system.py` æ£€æŸ¥WebSocketåŠŸèƒ½

4. **æ¨¡å‹åŠ è½½å¤±è´¥**
   - ç¡®è®¤æ¨¡å‹æ–‡ä»¶è·¯å¾„æ­£ç¡®
   - æ£€æŸ¥æ–‡ä»¶æƒé™
   - éªŒè¯æ¨¡å‹æ–‡ä»¶å®Œæ•´æ€§
   - è¿è¡Œ `python test_system.py` æ£€æŸ¥æ¨¡å‹æ–‡ä»¶

5. **å‰ç«¯æ˜¾ç¤ºå¼‚å¸¸**
   - åˆ·æ–°æµè§ˆå™¨é¡µé¢
   - æ£€æŸ¥JavaScriptæ§åˆ¶å°é”™è¯¯
   - ç¡®è®¤æµè§ˆå™¨æ”¯æŒWebSocket
   - å°è¯•ä½¿ç”¨Chromeæˆ–Firefoxæµè§ˆå™¨

### è°ƒè¯•æ¨¡å¼

å¯ç”¨è¯¦ç»†æ—¥å¿—è¾“å‡ºï¼š
```python
# åœ¨websocket_server.pyä¸­æ·»åŠ 
import logging
logging.basicConfig(level=logging.DEBUG)
```

## æ€§èƒ½ä¼˜åŒ–

1. **é™ä½æ›´æ–°é¢‘ç‡**
   - ä¿®æ”¹ `step_size` å‚æ•°
   - è°ƒæ•´å‰ç«¯åˆ·æ–°é—´éš”

2. **å‡å°‘å†å²æ•°æ®**
   - ä¿®æ”¹ `angleHistory.times.length > 200` ä¸­çš„æ•°å€¼

3. **ä¼˜åŒ–æ¨¡å‹æ¨ç†**
   - ä½¿ç”¨GPUåŠ é€Ÿï¼ˆå¦‚æœå¯ç”¨ï¼‰
   - è°ƒæ•´æ‰¹å¤„ç†å¤§å°

## æ‰©å±•åŠŸèƒ½

### æ·»åŠ æ–°çš„è§’åº¦ç»„
1. ä¿®æ”¹å‰ç«¯HTMLä¸­çš„è§’åº¦åˆ†ç»„
2. æ›´æ–°JavaScriptä¸­çš„è§’åº¦ç´¢å¼•æ˜ å°„
3. è°ƒæ•´å›¾è¡¨æ˜¾ç¤ºé€»è¾‘

### æ•°æ®å¯¼å‡º
å¯ä»¥æ·»åŠ CSVå¯¼å‡ºåŠŸèƒ½ï¼š
```javascript
function exportData() {
    const csv = convertToCSV(angleHistory);
    downloadCSV(csv, 'angle_data.csv');
}
```

### å®æ—¶å½•åˆ¶
å¯ä»¥æ·»åŠ å½•åˆ¶åŠŸèƒ½ä¿å­˜é¢„æµ‹æ•°æ®ï¼š
```python
# åœ¨websocket_server.pyä¸­æ·»åŠ 
def save_prediction_data(self, data):
    with open('prediction_log.csv', 'a') as f:
        writer = csv.writer(f)
        writer.writerow([data['timestamp']] + data['angles'])
```

## æŠ€æœ¯æ”¯æŒ

å¦‚æœ‰é—®é¢˜ï¼Œè¯·æ£€æŸ¥ï¼š
1. ç³»ç»Ÿæ—¥å¿—è¾“å‡º
2. æµè§ˆå™¨å¼€å‘è€…å·¥å…·
3. ç½‘ç»œè¿æ¥çŠ¶æ€
4. ç¡¬ä»¶è®¾å¤‡çŠ¶æ€

## ç‰ˆæœ¬ä¿¡æ¯

- ç‰ˆæœ¬ï¼š1.0.0
- æ›´æ–°æ—¥æœŸï¼š2024å¹´
- æ”¯æŒå¹³å°ï¼šWindows, Linux, macOS
- æµè§ˆå™¨è¦æ±‚ï¼šChrome 60+, Firefox 55+, Safari 11+ 