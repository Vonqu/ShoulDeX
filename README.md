# ShoulDex v1.5 - è‚©å…³èŠ‚è¿åŠ¨åˆ†æç³»ç»Ÿ

## é¡¹ç›®æ¦‚è¿°

ShoulDexæ˜¯ä¸€ä¸ªåŸºäºæ·±åº¦å­¦ä¹ çš„è‚©å…³èŠ‚è¿åŠ¨åˆ†æç³»ç»Ÿï¼Œé€šè¿‡èåˆå…‰å­¦åŠ¨ä½œæ•æ‰æ•°æ®å’Œå¯ç©¿æˆ´ä¼ æ„Ÿå™¨æ•°æ®ï¼Œå®ç°è‚©å…³èŠ‚è§’åº¦çš„å®æ—¶é¢„æµ‹å’Œè¿åŠ¨åˆ†æã€‚

### ä¸»è¦åŠŸèƒ½
- ğŸ“Š **æ•°æ®å¤„ç†**: å…‰å­¦åŠ¨æ•æ•°æ®å’Œä¼ æ„Ÿå™¨æ•°æ®çš„åŒæ­¥å¤„ç†
- ğŸ§  **æ·±åº¦å­¦ä¹ **: åŸºäºLSTMçš„è‚©å…³èŠ‚è§’åº¦é¢„æµ‹æ¨¡å‹
- ğŸ“ˆ **å®æ—¶é¢„æµ‹**: æ”¯æŒå®æ—¶è‚©å…³èŠ‚è§’åº¦é¢„æµ‹å’Œå¯è§†åŒ–
- ğŸ”§ **æ•°æ®å·¥å…·**: å®Œæ•´çš„æ•°æ®é›†åˆ’åˆ†å’Œé¢„å¤„ç†å·¥å…·é“¾
- ğŸ“Š **è¿åŠ¨åˆ†æ**: ROM(è¿åŠ¨èŒƒå›´)ç»Ÿè®¡åˆ†æå’Œå¯è§†åŒ–

## é¡¹ç›®æ¶æ„

```
ShoulDex_v1.5/
â”œâ”€â”€ data/                           # æ•°æ®ç›®å½•
â”‚   â”œâ”€â”€ raw_data/                   # åŸå§‹æ•°æ®
â”‚   â”œâ”€â”€ dft_final/                  # å¤„ç†åçš„æœ€ç»ˆæ•°æ®
â”‚   â””â”€â”€ model_training/             # æ¨¡å‹è®­ç»ƒæ•°æ®é›†
â”‚       â”œâ”€â”€ train/                  # è®­ç»ƒé›†
â”‚       â””â”€â”€ test/                   # æµ‹è¯•é›†
â”œâ”€â”€ data_processing/                # æ•°æ®å¤„ç†æ¨¡å—
â”‚   â”œâ”€â”€ tool/                       # æ•°æ®å¤„ç†å·¥å…·
â”‚   â”‚   â”œâ”€â”€ dataset_split.py        # ğŸ†• æ•°æ®é›†åˆ’åˆ†å·¥å…·
â”‚   â”‚   â”œâ”€â”€ load_training_data.py   # è®­ç»ƒæ•°æ®åŠ è½½
â”‚   â”‚   â””â”€â”€ rename.py               # æ–‡ä»¶é‡å‘½åå·¥å…·
â”‚   â”œâ”€â”€ angle_calculation/          # è§’åº¦è®¡ç®—
â”‚   â”œâ”€â”€ rom_anylsis/                # ROMåˆ†æ
â”‚   â””â”€â”€ *.py                        # å„ç§æ•°æ®å¤„ç†è„šæœ¬
â”œâ”€â”€ train/                          # æ¨¡å‹è®­ç»ƒæ¨¡å—
â”‚   â”œâ”€â”€ model.py                    # æ¨¡å‹å®šä¹‰
â”‚   â”œâ”€â”€ lstm_*.py                   # LSTMè®­ç»ƒè„šæœ¬
â”‚   â””â”€â”€ result/                     # è®­ç»ƒç»“æœ
â”œâ”€â”€ predict/                        # é¢„æµ‹æ¨¡å—
â”‚   â”œâ”€â”€ predict_*.py                # é¢„æµ‹è„šæœ¬
â”‚   â”œâ”€â”€ scaler/                     # æ•°æ®å½’ä¸€åŒ–å™¨
â”‚   â””â”€â”€ *.html                      # å¯è§†åŒ–ç•Œé¢
â”œâ”€â”€ model/                          # è®­ç»ƒå¥½çš„æ¨¡å‹
â””â”€â”€ log/                            # æ—¥å¿—æ–‡ä»¶
```

## æ•°æ®æ ¼å¼è¯´æ˜

### CSVæ•°æ®æ–‡ä»¶ç»“æ„
æ¯ä¸ªCSVæ–‡ä»¶åŒ…å«ä»¥ä¸‹åˆ—ï¼š
- `Time_angle`: æ—¶é—´æˆ³
- `s1-s14`: 14ä¸ªä¼ æ„Ÿå™¨æ•°æ®
- `A_*`: 27ä¸ªè‚©å…³èŠ‚è§’åº¦æ•°æ®
  - `A_humerus_l/r_thorax_X/Y/Z`: å·¦/å³è‚±éª¨ä¸èƒ¸å»“è§’åº¦
  - `A_scapula_l/r_thorax_X/Y/Z`: å·¦/å³è‚©èƒ›éª¨ä¸èƒ¸å»“è§’åº¦
  - `A_clavicle_l/r_thorax_X/Y/Z`: å·¦/å³é”éª¨ä¸èƒ¸å»“è§’åº¦
  - `A_humerus_l/r_scapula_X/Y/Z`: å·¦/å³è‚±éª¨ä¸è‚©èƒ›éª¨è§’åº¦
  - `A_thorax_hip_X/Y/Z`: èƒ¸å»“ä¸é«‹å…³èŠ‚è§’åº¦

### æ–‡ä»¶å‘½åè§„èŒƒ
- æ ¼å¼: `{è¢«è¯•ID}_{åŠ¨ä½œç±»å‹}_{å…¶ä»–ä¿¡æ¯}.csv`
- ç¤ºä¾‹:
  - `P1_AB_fps30.csv`: è¢«è¯•P1çš„å¤–å±•(AB)åŠ¨ä½œï¼Œ30fps
  - `P2_C_RH_fps30_jianjiagu.csv`: è¢«è¯•P2çš„è¡¥å¿æ€§åˆ°è¾¾(C_RH)åŠ¨ä½œ

## ğŸ†• æ•°æ®é›†åˆ’åˆ†å·¥å…·

### åŠŸèƒ½ç‰¹ç‚¹
- ğŸ“ **æ™ºèƒ½æ–‡ä»¶æ‰«æ**: è‡ªåŠ¨é€’å½’æ‰«æç›®å½•ä¸­çš„æ‰€æœ‰CSVæ–‡ä»¶
- ğŸ¯ **å¤šç§åˆ’åˆ†ç­–ç•¥**: 
  - æŒ‰è¢«è¯•åˆ’åˆ†(æ¨è): ç¡®ä¿åŒä¸€è¢«è¯•çš„æ•°æ®ä¸ä¼šåŒæ—¶å‡ºç°åœ¨è®­ç»ƒé›†å’Œæµ‹è¯•é›†
  - æŒ‰åŠ¨ä½œå¹³è¡¡åˆ’åˆ†: ç¡®ä¿æ¯ç§åŠ¨ä½œåœ¨è®­ç»ƒé›†å’Œæµ‹è¯•é›†ä¸­éƒ½æœ‰åˆç†åˆ†å¸ƒ
  - éšæœºåˆ’åˆ†: å®Œå…¨éšæœºçš„æ–‡ä»¶çº§åˆ«åˆ’åˆ†
- ğŸ“Š **è¯¦ç»†ç»Ÿè®¡åˆ†æ**: è‡ªåŠ¨åˆ†æè¢«è¯•åˆ†å¸ƒã€åŠ¨ä½œåˆ†å¸ƒã€æ ·æœ¬æ•°é‡ç­‰
- ğŸ’¾ **åˆ’åˆ†ä¿¡æ¯è®°å½•**: ä¿å­˜è¯¦ç»†çš„åˆ’åˆ†ä¿¡æ¯åˆ°JSONæ–‡ä»¶
- ğŸ”„ **å¯é‡ç°ç»“æœ**: é€šè¿‡éšæœºç§å­ç¡®ä¿ç»“æœå¯é‡ç°

### ä½¿ç”¨æ–¹æ³•

#### 1. å‘½ä»¤è¡Œä½¿ç”¨
```bash
# åŸºæœ¬ç”¨æ³• - æŒ‰è¢«è¯•åˆ’åˆ†ï¼ˆæ¨èï¼‰
python data_processing/tool/dataset_split.py data/dft_final

# æŒ‡å®šè¾“å‡ºç›®å½•å’Œè®­ç»ƒé›†æ¯”ä¾‹
python data_processing/tool/dataset_split.py data/dft_final -o ./data/new_split -r 0.7

# æŒ‰åŠ¨ä½œç±»å‹å¹³è¡¡åˆ’åˆ†
python data_processing/tool/dataset_split.py data/dft_final -m by_motion

# éšæœºåˆ’åˆ†
python data_processing/tool/dataset_split.py data/dft_final -m random

# è®¾ç½®éšæœºç§å­
python data_processing/tool/dataset_split.py data/dft_final -s 123
```

#### 2. Pythonè„šæœ¬ä½¿ç”¨
```python
from data_processing.tool.dataset_split import DatasetSplitter

# åˆ›å»ºåˆ’åˆ†å™¨
splitter = DatasetSplitter(
    input_dir="data/dft_final",
    output_dir="./data/model_training",
    train_ratio=0.8,
    random_seed=42
)

# æ‰§è¡Œåˆ’åˆ†
splitter.split_dataset(split_method="by_subject")
```

#### 3. å‚æ•°è¯´æ˜
- `input_dir`: è¾“å…¥æ•°æ®ç›®å½•ï¼ˆå¿…éœ€ï¼‰
- `-o/--output_dir`: è¾“å‡ºç›®å½•ï¼Œé»˜è®¤`./data/model_training`
- `-r/--train_ratio`: è®­ç»ƒé›†æ¯”ä¾‹ï¼Œé»˜è®¤0.8
- `-m/--method`: åˆ’åˆ†æ–¹æ³•ï¼Œå¯é€‰`by_subject`/`by_motion`/`random`ï¼Œé»˜è®¤`by_subject`
- `-s/--seed`: éšæœºç§å­ï¼Œé»˜è®¤42

### åˆ’åˆ†ç­–ç•¥å¯¹æ¯”

| ç­–ç•¥ | ä¼˜ç‚¹ | ç¼ºç‚¹ | æ¨èåœºæ™¯ |
|------|------|------|----------|
| **æŒ‰è¢«è¯•åˆ’åˆ†** | é¿å…æ•°æ®æ³„éœ²ï¼Œæ›´çœŸå®çš„æ³›åŒ–æ€§èƒ½ | å¯èƒ½å¯¼è‡´æŸäº›åŠ¨ä½œåœ¨æµ‹è¯•é›†ä¸­è¾ƒå°‘ | **ç”Ÿäº§ç¯å¢ƒä½¿ç”¨ï¼ˆæ¨èï¼‰** |
| **æŒ‰åŠ¨ä½œå¹³è¡¡** | æ¯ç§åŠ¨ä½œéƒ½æœ‰è¶³å¤Ÿçš„æµ‹è¯•æ ·æœ¬ | å¯èƒ½å­˜åœ¨æ•°æ®æ³„éœ²é£é™© | åŠ¨ä½œè¯†åˆ«å’Œåˆ†ç±»ä»»åŠ¡ |
| **éšæœºåˆ’åˆ†** | ç®€å•ç›´æ¥ | å®¹æ˜“é€ æˆæ•°æ®æ³„éœ² | å¿«é€ŸåŸå‹éªŒè¯ |

## æ¨¡å‹è®­ç»ƒ

### æ”¯æŒçš„æ¨¡å‹é…ç½®
- **è¾“å…¥**: 14ä¸ªä¼ æ„Ÿå™¨æ•°æ® (s1-s14)
- **è¾“å‡º**: 15æˆ–27ä¸ªè§’åº¦æ•°æ®
- **æ¨¡å‹**: LSTMç¥ç»ç½‘ç»œ
- **åºåˆ—é•¿åº¦**: å¯é…ç½®

### ğŸ†• æ”¹è¿›çš„åˆ†æ®µæ•°æ®åŠ è½½
ä¸ºäº†é¿å…è®­ç»ƒæ•°æ®ä¸­ä¸åŒåŠ¨ä½œæ®µä¹‹é—´çš„äººå·¥è¿æ¥é—®é¢˜ï¼Œæˆ‘ä»¬æä¾›äº†åŸºäºåˆ†æ®µçš„æ•°æ®åŠ è½½å™¨ï¼š

#### æ ¸å¿ƒä¼˜åŠ¿
- ğŸ“Š **åˆ†æ®µæ»‘çª—å¤„ç†**: å¯¹æ¯ä¸ªåŠ¨ä½œæ®µåˆ†åˆ«è¿›è¡Œæ»‘åŠ¨çª—å£å¤„ç†
- ğŸš« **é¿å…è·¨æ®µæ±¡æŸ“**: ç¡®ä¿æ¯ä¸ªè®­ç»ƒçª—å£éƒ½æ¥è‡ªåŒä¸€åŠ¨ä½œæ®µ
- ğŸ¯ **æ›´çº¯å‡€çš„æ•°æ®**: æ¶ˆé™¤ä¸åŒåŠ¨ä½œé—´çš„äººå·¥è½¬æ¢
- ğŸ“ˆ **æ›´å¥½çš„æ€§èƒ½**: æ¨¡å‹å­¦ä¹ åˆ°æ›´çœŸå®çš„åŠ¨ä½œæ¨¡å¼

#### ä½¿ç”¨æ–¹æ³•
```python
# å¯¼å…¥æ–°çš„æ•°æ®åŠ è½½å™¨
from data_processing.tool.load_training_data_segment_based import SegmentBasedDataLoader

# åˆ›å»ºåˆ†æ®µæ•°æ®åŠ è½½å™¨
data_loader = SegmentBasedDataLoader(
    train_folder='./data/model_training/train',
    test_folder='./data/model_training/test',
    window_size=60,      # æ—¶é—´çª—å£å¤§å°
    time_step=3,         # æ—¶é—´æ­¥é•¿
    batch_size=256,
    validation_split=0.2,
    trial_id='your_trial_id'
)

# åŠ è½½å’Œé¢„å¤„ç†æ•°æ®
data_loader.load_and_prepare_data()

# è·å–æ•°æ®åŠ è½½å™¨
train_loader, val_loader, test_loader = data_loader.get_data_loaders()
```

### è®­ç»ƒè„šæœ¬
```bash
# è®­ç»ƒå³ä¾§14ä¼ æ„Ÿå™¨åˆ°15è§’åº¦æ¨¡å‹
python train/lstm_right_side_output.py

# è®­ç»ƒåŒä¾§27è§’åº¦è¾“å‡ºæ¨¡å‹  
python train/lstm_output_27angle.py

# ä½¿ç”¨æ”¹è¿›çš„æ•°æ®åŠ è½½å™¨è®­ç»ƒ
python train/notebook_modification_guide.py  # æŸ¥çœ‹ä¿®æ”¹æŒ‡å¯¼
```

## å®æ—¶é¢„æµ‹ç³»ç»Ÿ

### å¯åŠ¨é¢„æµ‹æœåŠ¡
```bash
# å¯åŠ¨WebSocketæœåŠ¡å™¨
python predict/websocket_server.py

# å¯åŠ¨å¯è§†åŒ–ç•Œé¢
python predict/start_dashboard.py
```

### é¢„æµ‹è„šæœ¬
- `predict_r_side_14to15_local.py`: å³ä¾§14ä¼ æ„Ÿå™¨é¢„æµ‹15è§’åº¦
- `predict_ds_14Sto27A_local.py`: 14ä¼ æ„Ÿå™¨é¢„æµ‹27è§’åº¦
- `predict_pxy_local.py`: é€šç”¨é¢„æµ‹è„šæœ¬

## æ•°æ®å¤„ç†å·¥å…·

### æ‰¹é‡æ•°æ®å¤„ç†
```bash
# å¹¶è¡Œæ‰¹é‡å¤„ç†
python data_processing/batch_data_process_pxy_parallel.py

# æ™®é€šæ‰¹é‡å¤„ç†
python data_processing/batch_data_process_pxy.py
```

### ROMåˆ†æ
```bash
# è¿åŠ¨èŒƒå›´åˆ†æ
python data_processing/rom_anylsis/rom_cal.py
```

### è§’åº¦è®¡ç®—
```bash
# åæ ‡ç³»è§’åº¦è®¡ç®—
python data_processing/angle_calculation/angle_cal_coordinate.py
```

## ç¯å¢ƒé…ç½®

### ä¾èµ–åº“
```bash
pip install pandas numpy scikit-learn torch matplotlib seaborn
pip install pathlib argparse json datetime
```

### Pythonç‰ˆæœ¬è¦æ±‚
- Python 3.7+
- PyTorch 1.8+
- pandas 1.3+
- numpy 1.20+

## ä½¿ç”¨æµç¨‹

### 1. æ•°æ®å‡†å¤‡
1. å°†åŸå§‹å…‰å­¦åŠ¨æ•æ•°æ®å’Œä¼ æ„Ÿå™¨æ•°æ®æ”¾å…¥`data/raw_data/`
2. è¿è¡Œæ•°æ®å¤„ç†è„šæœ¬ç”Ÿæˆå¯¹é½çš„æ•°æ®æ–‡ä»¶
3. ä½¿ç”¨æ•°æ®é›†åˆ’åˆ†å·¥å…·åˆ›å»ºè®­ç»ƒ/æµ‹è¯•é›†

### 2. æ¨¡å‹è®­ç»ƒ
1. ä½¿ç”¨`dataset_split.py`åˆ’åˆ†æ•°æ®é›†
2. è¿è¡Œç›¸åº”çš„LSTMè®­ç»ƒè„šæœ¬
3. æ¨¡å‹ä¿å­˜åœ¨`model/`ç›®å½•

### 3. é¢„æµ‹ä½¿ç”¨
1. å¯åŠ¨é¢„æµ‹æœåŠ¡
2. é€šè¿‡Webç•Œé¢æˆ–APIè¿›è¡Œå®æ—¶é¢„æµ‹
3. æŸ¥çœ‹é¢„æµ‹ç»“æœå’Œå¯è§†åŒ–


## æœ€æ–°æ›´æ–°

### v1.5 æ–°åŠŸèƒ½
- âœ¨ æ–°å¢æ™ºèƒ½æ•°æ®é›†åˆ’åˆ†å·¥å…· (`dataset_split.py`)
- ğŸ“Š å¢å¼ºçš„ç»Ÿè®¡åˆ†æåŠŸèƒ½
- ğŸ”§ æ”¹è¿›çš„å‘½ä»¤è¡Œæ¥å£
- ğŸ“ å®Œå–„çš„æ–‡æ¡£å’Œä½¿ç”¨è¯´æ˜
- ğŸ†• **åˆ†æ®µæ•°æ®åŠ è½½å™¨** (`load_training_data_segment_based.py`)
  - è§£å†³åŸæœ‰æ•°æ®æ‹¼æ¥å¯¼è‡´çš„è·¨æ®µé—®é¢˜
  - æ¯ä¸ªåŠ¨ä½œæ®µç‹¬ç«‹è¿›è¡Œæ»‘çª—å¤„ç†
  - æä¾›è¯¦ç»†çš„ä¿®æ”¹æŒ‡å¯¼æ–‡æ¡£
  - æ”¯æŒçµæ´»çš„å‚æ•°é…ç½®

## è®¸å¯è¯

æœ¬é¡¹ç›®ä»…ä¾›å­¦æœ¯ç ”ç©¶ä½¿ç”¨ã€‚

---

*æœ€åæ›´æ–°: 2025å¹´1æœˆ* 
